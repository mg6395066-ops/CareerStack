# Email Verification System - Quick Reference\n\n## üöÄ Quick Start\n\n### Test Email System\n```bash\nnode scripts/test-email-verification.js\n```\n\n### User Registration Flow\n```\n1. User registers on /register page\n2. System sends verification email automatically\n3. User clicks link in email\n4. Email is verified, account pending admin approval\n5. User can log in after admin approval\n```\n\n## üìß Email Configuration\n\n### Gmail SMTP (Current Setup)\n```bash\nEMAIL_USER=your-email@gmail.com\nEMAIL_PASSWORD=xxxx-xxxx-xxxx-xxxx  # App Password (16 chars with spaces)\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\n```\n\n### Setup Gmail App Password\n1. Enable 2-Step Verification: https://myaccount.google.com/security\n2. Generate App Password: https://myaccount.google.com/apppasswords\n3. Select \"Mail\" and \"Windows Computer\"\n4. Copy password (16 characters with spaces)\n5. Paste in .env (spaces auto-stripped)\n\n## üîå API Endpoints\n\n### Register User\n```http\nPOST /api/auth/register\n{\n  \"email\": \"user@example.com\",\n  \"password\": \"password123\",\n  \"pseudoName\": \"username\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\"\n}\n```\n\n### Verify Email\n```http\nGET /api/auth/verify-email?token=<token>\n```\n\n### Resend Verification\n```http\nPOST /api/auth/resend-verification\n{\n  \"email\": \"user@example.com\"\n}\n```\n\n## üîê Token Details\n\n- **Type**: SHA-256 hashed\n- **Length**: 64 hex characters\n- **Expiration**: 24 hours\n- **Storage**: Only hash stored, raw token sent via email\n- **Security**: One-time use, can't be reused\n\n## ‚ö° Rate Limiting\n\n- **Limit**: 3 requests per 5 minutes\n- **Scope**: Per email + IP address\n- **Response**: HTTP 429 with Retry-After header\n\n## üõ†Ô∏è Troubleshooting\n\n### Emails not sending?\n```bash\n# 1. Run diagnostic\nnode scripts/test-email-verification.js\n\n# 2. Check server logs for errors\n# Look for \"‚ùå Failed to send verification email\"\n\n# 3. Verify .env configuration\n# EMAIL_USER, EMAIL_PASSWORD, EMAIL_HOST, EMAIL_PORT must be set\n\n# 4. Check Gmail:\n# - 2-Step Verification enabled?\n# - App Password generated?\n# - Correct password copied?\n```\n\n### Token validation fails?\n```\n1. Verify token is in URL: /verify-email?token=xyz\n2. Check token hasn't expired (24 hours)\n3. Ensure token matches format (64 hex chars)\n4. Try resending verification email (max 3 per 5 min)\n```\n\n### Rate limit error?\n```\n1. Check Retry-After header: tells you when to retry\n2. Wait specified seconds, then try again\n3. Limit is per email + IP, not per device\n```\n\n## üìä Status Codes\n\n| Code | Meaning | Action |\n|------|---------|--------|\n| 200 | Email verified | User can proceed |\n| 201 | Registration successful | Check email |\n| 400 | Invalid token | Ask to resend |\n| 401 | Not authenticated | Log in first |\n| 429 | Too many requests | Wait (see Retry-After) |\n| 500 | Server error | Check server logs |\n\n## üìÅ Key Files\n\n```\nserver/\n  services/authService.ts          # Token generation, email sending\n  utils/email.ts                   # Email transporter, templates\n  controllers/authController.ts    # Registration, verification\n  routes.ts                        # API endpoints\n  \nclient/src/pages/\n  verify-email.tsx                 # Email verification page\n  \ndocs/\n  EMAIL_VERIFICATION_SYSTEM.md     # Full documentation\n  EMAIL_VERIFICATION_QUICK_REFERENCE.md  # This file\n  \nscripts/\n  test-email-verification.js       # Email system test\n```\n\n## üîß Environment Variables\n\n### Required\n```bash\nEMAIL_USER=your-email@gmail.com\nEMAIL_PASSWORD=your-app-password\nEMAIL_HOST=smtp.gmail.com\nEMAIL_PORT=587\nEMAIL_SERVICE=gmail\n```\n\n### Optional\n```bash\nEMAIL_SECURE=false\nEMAIL_FROM=\"App Name\" <email@example.com>\nEMAIL_DOMAIN=localhost\nSUPPORT_EMAIL=support@example.com\nADMIN_EMAIL=admin@example.com\nTEST_EMAIL_TO=test@example.com\n```\n\n## üì± Frontend Pages\n\n### Registration Page\n- **Path**: `/register`\n- **Action**: Create account and send verification email\n- **Next**: User checks email\n\n### Verification Page\n- **Path**: `/verify-email?token=xxx`\n- **Action**: Verify token and show status\n- **Next**: User logs in\n\n## üéØ Common Tasks\n\n### Test email sending\n```bash\nnode scripts/test-email-verification.js\n```\n\n### Check if email was sent\n1. Open Gmail inbox for EMAIL_USER\n2. Look for email subject with verification link\n3. Check spam/junk folder if not in inbox\n\n### Manually test verification\n1. Register: POST to /api/auth/register\n2. Get token from response (test only)\n3. Visit: /verify-email?token={token}\n4. Should show success message\n\n### Reset user email verification\n1. Open database\n2. Set emailVerified = false\n3. Clear emailVerificationToken\n4. User can request resend\n\n## üö® Important Notes\n\n- ‚úÖ **Security**: Tokens are hashed before storage\n- ‚úÖ **Privacy**: Emails are not logged in plain text\n- ‚úÖ **Reliability**: Fallback email sending if primary fails\n- ‚ö†Ô∏è **Gmail**: Requires App Password, not regular password\n- ‚ö†Ô∏è **Tokens**: Expire after 24 hours, send resend link\n- ‚ö†Ô∏è **Rate Limit**: Per email + IP, not per device\n\n## üìû Support\n\n### For Email Issues\n1. Run test: `node scripts/test-email-verification.js`\n2. Check logs: Look for error messages\n3. Verify credentials: Correct App Password?\n4. Test sending: Manual test from /register\n\n### For Token Issues\n1. Check URL parameter: `?token=xxx`\n2. Verify expiration: 24 hours from sent\n3. Request resend: Max 3 per 5 minutes per email+IP\n\n### For Database Issues\n1. Check schema: emailVerificationToken field exists?\n2. Check indexes: emailVerificationExpires field indexed?\n3. Run migrations: All tables created?\n\n---\n\n**Last Updated**: December 2024\n"